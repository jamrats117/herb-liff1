<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£</title>

  <style>
    :root{
      --bg: #EBF4DD;
      --p1: #90AB8B;
      --p2: #5A7863;
      --p3: #3B4953;

      --card: rgba(255,255,255,.58);
      --card2: rgba(255,255,255,.42);
      --border: rgba(90,120,99,.25);
      --shadow: 0 18px 40px rgba(59,73,83,.18);
      --shadow2: 0 10px 22px rgba(59,73,83,.12);
      --radius: 18px;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color: var(--p3);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(144,171,139,.55), transparent 55%),
        radial-gradient(1000px 520px at 85% 25%, rgba(90,120,99,.35), transparent 60%),
        linear-gradient(180deg, var(--bg), #f7fbf1);
      padding: 18px;
    }

    .wrap{ max-width: 820px; margin: 0 auto; }
    .hero{
      padding: 18px 18px 12px;
      border-radius: var(--radius);
      background: linear-gradient(135deg, rgba(255,255,255,.62), rgba(255,255,255,.35));
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .title{
      display:flex; align-items:center; gap:10px;
      margin: 0 0 10px;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: .2px;
      color: var(--p3);
    }
    .title .dot{
      width: 12px; height: 12px; border-radius: 50%;
      background: linear-gradient(180deg, var(--p1), var(--p2));
      box-shadow: 0 6px 14px rgba(90,120,99,.35);
    }

    .sub{
      margin: 0 0 14px;
      color: rgba(59,73,83,.78);
      font-size: 13.5px;
      line-height: 1.45;
    }

    .searchbar{
      display:flex; gap:10px; align-items:center;
      padding: 10px;
      border-radius: 16px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(90,120,99,.22);
      box-shadow: var(--shadow2);
    }

    input{
      width:100%;
      border: 0;
      outline: none;
      background: transparent;
      padding: 10px 8px;
      font-size: 16px;
      color: var(--p3);
    }
    input::placeholder{ color: rgba(59,73,83,.55); }

    .chip{
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(144,171,139,.18);
      border: 1px solid rgba(144,171,139,.28);
      color: rgba(59,73,83,.9);
      white-space: nowrap;
    }

    .status{
      margin: 12px 2px 0;
      font-size: 13px;
      color: rgba(59,73,83,.74);
    }

    .list{ margin-top: 14px; }

    .item{
      padding: 14px 14px;
      border-radius: 18px;
      border: 1px solid rgba(90,120,99,.20);
      background: rgba(255,255,255,.56);
      box-shadow: 0 10px 22px rgba(59,73,83,.10);
      backdrop-filter: blur(9px);
      -webkit-backdrop-filter: blur(9px);
      cursor: pointer;
      transition: transform .08s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .item + .item{ margin-top: 10px; }
    .item:active{ transform: scale(.995); }
    .item:hover{ border-color: rgba(90,120,99,.32); box-shadow: 0 16px 34px rgba(59,73,83,.14); }

    .row{
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
    }
    .name{
      font-weight: 800;
      font-size: 16.5px;
      line-height: 1.2;
      color: var(--p3);
    }
    .code{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(59,73,83,.08);
      border: 1px solid rgba(59,73,83,.12);
      color: rgba(59,73,83,.85);
      flex: 0 0 auto;
    }
    .meta{
      margin-top: 8px;
      font-size: 13px;
      color: rgba(59,73,83,.72);
    }
    .meta b{ color: rgba(59,73,83,.88); }

    .footer{
      margin-top: 16px;
      padding: 14px;
      border-radius: var(--radius);
      background: rgba(255,255,255,.52);
      border: 1px solid rgba(90,120,99,.18);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .footer p{
      margin: 0 0 10px;
      color: rgba(59,73,83,.8);
      font-size: 13px;
      line-height: 1.5;
    }
    .actions{
      display:flex; gap:10px; flex-wrap: wrap;
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(90,120,99,.25);
      background: rgba(144,171,139,.18);
      color: var(--p3);
      text-decoration: none;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 10px 20px rgba(59,73,83,.10);
      transition: transform .08s ease, box-shadow .12s ease, background .12s ease;
    }
    .btn:hover{ background: rgba(144,171,139,.24); box-shadow: 0 14px 28px rgba(59,73,83,.12); }
    .btn:active{ transform: scale(.995); }
    .btn.secondary{
      background: rgba(90,120,99,.16);
    }

    /* small screens */
    @media (max-width: 420px){
      body{ padding: 14px; }
      .title{ font-size: 20px; }
      .chip{ display:none; }
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="hero">
    <div class="title"><span class="dot"></span>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£ (‡∏ú‡∏•‡∏ï‡πà‡∏≠ INR)</div>
    <p class="sub">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ <b>2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</b> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>

    <div class="searchbar">
      <input id="q" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏∞ / ‡∏Å‡∏£‡∏∞ / ‡∏ä‡∏≤" autocomplete="off" />
      <span class="chip">üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</span>
    </div>

    <div id="status" class="status">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)</div>
    <div id="list" class="list"></div>

    <div class="footer">
      <p>‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà</p>
      <div class="actions">
        <!-- ‚úÖ ‡πÅ‡∏Å‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ -->
        <a class="btn" id="btnCall" href="tel:TEL_NUMBER">üìû ‡πÇ‡∏ó‡∏£</a>
        <!-- ‚úÖ ‡πÅ‡∏Å‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå -->
        <a class="btn secondary" id="btnLine" href="LINE_URL" target="_blank" rel="noreferrer">üí¨ ‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå</a>
      </div>
    </div>
  </div>
</div>

<script>
const LIFF_ID = "2008700999-92JSGt6D";
const API_BASE = "https://script.google.com/macros/s/AKfycbwEWUXrX0Z_atDK8di4NKUjBTcGEkLK0GrrGuYFou-UjhYo1eYIDyvo1XtAHCLMGMW5Rg/exec"; // ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ .../exec


let timer = null;
let controller = null;
let lastQuery = "";
let reqSeq = 0;

function setStatus(text){
  document.getElementById("status").textContent = text;
}
function clearList(){
  document.getElementById("list").innerHTML = "";
}
function escapeHtml(s){
  return String(s ?? "").replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}

function render(items){
  const el = document.getElementById("list");
  el.innerHTML = "";
  items.forEach(x => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="row">
        <div class="name">${escapeHtml(x.herb)}</div>
        <div class="code">${escapeHtml(x.code)}</div>
      </div>
      <div class="meta"><b>${escapeHtml(x.effect)}</b> ‚Ä¢ LOE: ${escapeHtml(x.loe || "-")}</div>
    `;
    // ‚úÖ ‡∏™‡πà‡∏á ‚Äú‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£‚Äù ‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏ä‡∏ó (‡πÑ‡∏°‡πà‡πÇ‡∏ä‡∏ß‡πå HERB_SELECT|...)
    div.onclick = () => selectHerb(x.herb);
    el.appendChild(div);
  });
}

async function init(){
  await liff.init({ liffId: LIFF_ID });

  const input = document.getElementById("q");
  input.addEventListener("input", () => {
    const q = input.value.trim();
    clearTimeout(timer);
    timer = setTimeout(() => runSearch(q), 250);
  });

  clearList();
  setStatus("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)");
}

async function runSearch(q){
  if (q === lastQuery) return;
  lastQuery = q;

  if (!q || q.length < 2){
    if (controller) controller.abort();
    clearList();
    setStatus("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)");
    return;
  }

  if (controller) controller.abort();
  controller = new AbortController();
  const mySeq = ++reqSeq;

  setStatus("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...");

  // ‚úÖ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö ‚Äú‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‚Äù (‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏ù‡∏±‡πà‡∏á Apps Script ‡πÉ‡∏´‡πâ _search = herb)
  const url = `${API_BASE}?action=search&q=${encodeURIComponent(q)}`;

  try{
    const res = await fetch(url, { signal: controller.signal, cache: "no-store" });
    const json = await res.json();
    if (mySeq !== reqSeq) return;

    const items = json.data || [];
    if (!items.length){
      clearList();
      setStatus("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå");
      return;
    }
    render(items);
    setStatus(`‡∏û‡∏ö ${items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
  } catch(err){
    if (err.name === "AbortError") return;
    clearList();
    setStatus("‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
  }
}

async function selectHerb(herb){
  await liff.sendMessages([{ type:"text", text: herb }]); // ‡πÅ‡∏ä‡∏ó‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô ‚Äú‡∏°‡∏∞‡∏ô‡∏≤‡∏ß‚Äù
  liff.closeWindow();
}

init();
</script>
</body>
</html>
